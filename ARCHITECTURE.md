# Архитектура автономной AI Content Entity

## Философия системы

Система проектируется как **автономная сущность**, а не инструмент. Она принимает решения, учится на опыте и эволюционирует во времени.

---

## Архитектурные принципы

### 1. Модульность и изоляция
- Каждый модуль имеет четкую ответственность
- Минимальная связанность между модулями
- Четкие интерфейсы для взаимодействия

### 2. Агентная архитектура
- Агенты работают независимо
- Общаются через события и сообщения
- Каждый агент имеет свой цикл намерения

### 3. Intent Loop (Цикл намерения)
Все агенты следуют единому циклу:
```
observation → thought → intent → action → reflection
```

### 4. Долгая память
- Все решения логируются
- Контекст сохраняется для обучения
- Избежание повторов через embeddings

### 5. Автономность
- Система принимает решения самостоятельно
- Пользователь задает цели, не команды
- Возможность отказа от действия

---

## Структура проекта

```
autoposst/
├── core/                    # Ядро системы
│   ├── entity.py           # Главная сущность
│   ├── intent_loop.py      # Цикл намерения
│   ├── orchestrator.py     # Оркестратор агентов
│   └── scheduler.py        # Планировщик задач
│
├── agents/                  # Агенты
│   ├── base.py             # Базовый класс агента
│   ├── thinker.py          # Выбор темы и решения
│   ├── writer.py           # Написание контента
│   ├── editor.py           # Редактирование под платформу
│   ├── critic.py           # Критика и валидация
│   ├── publisher.py        # Публикация
│   └── archivist.py        # Управление памятью
│
├── memory/                  # Система памяти
│   ├── storage.py          # SQLite хранилище
│   ├── embeddings.py       # Работа с embeddings
│   ├── index.py            # Индексация и поиск
│   └── models.py           # Модели данных
│
├── ai/                      # AI интеграция
│   ├── router.py           # Роутер моделей
│   ├── gemini_client.py    # Gemini API клиент
│   ├── models.py           # Конфигурация моделей
│   └── prompts.py          # Промпты для агентов
│
├── platforms/               # Интеграции платформ
│   ├── base.py             # Базовый класс платформы
│   ├── vk/                 # VK
│   │   ├── client.py
│   │   ├── auth.py
│   │   └── publisher.py
│   ├── telegram/           # Telegram
│   │   ├── client.py
│   │   └── publisher.py
│   └── dzen/               # Dzen
│       ├── browser.py
│       └── publisher.py
│
├── ui/                      # Desktop UI
│   ├── main.py             # Главное окно
│   ├── dashboard.py        # Dashboard виджет
│   ├── goals.py            # Goals виджет
│   ├── platforms_panel.py  # Platforms панель
│   └── widgets/            # Переиспользуемые виджеты
│
├── security/                # Безопасность
│   ├── encryption.py       # AES шифрование
│   └── token_storage.py    # Хранение токенов
│
├── config/                  # Конфигурация
│   ├── settings.py         # Настройки системы
│   ├── goals.py            # Управление целями
│   └── defaults.py         # Значения по умолчанию
│
├── utils/                   # Утилиты
│   ├── logger.py           # Логирование
│   ├── validators.py       # Валидация
│   └── helpers.py          # Вспомогательные функции
│
└── main.py                  # Точка входа
```

---

## Детальная архитектура модулей

### Core.Entity

Главная сущность системы. Координирует работу всех компонентов.

**Ответственность:**
- Инициализация всех модулей
- Управление жизненным циклом
- Координация агентов
- Обработка глобальных событий

**Состояние:**
- Активные цели
- Текущее намерение
- Статус системы
- История действий

---

### Core.IntentLoop

Реализует цикл намерения для всех агентов.

**Фазы:**
1. **Observation** - сбор информации
2. **Thought** - анализ и размышление
3. **Intent** - формирование намерения
4. **Action** - выполнение действия
5. **Reflection** - анализ результата

**Особенности:**
- Асинхронное выполнение
- Обработка ошибок
- Логирование каждого шага

---

### Agents.Base

Базовый класс для всех агентов.

**Интерфейс:**
```python
class Agent:
    async def observe(self, context: Context) -> Observation
    async def think(self, observation: Observation) -> Thought
    async def form_intent(self, thought: Thought) -> Intent
    async def act(self, intent: Intent) -> Action
    async def reflect(self, action: Action, result: Result) -> Reflection
```

**Общие возможности:**
- Доступ к памяти
- Доступ к AI роутеру
- Логирование
- Метрики

---

### Agents.Thinker

**Ответственность:**
- Выбор темы для контента
- Решение: публиковать или нет
- Анализ актуальности

**Использует:**
- Memory для проверки повторов
- AI для генерации идей
- Goals для ориентации

---

### Agents.Writer

**Ответственность:**
- Написание первичного контента
- Выбор формата
- Определение длины

**Использует:**
- Gemini для генерации
- Prompts для стиля
- Context для персонализации

---

### Agents.Editor

**Ответственность:**
- Адаптация контента под платформу
- Улучшение стиля
- Проверка соответствия

**Использует:**
- Platform specifications
- AI для редактирования
- Style guides

---

### Agents.Critic

**Ответственность:**
- Критическая оценка контента
- Выявление слабостей
- Решение об одобрении

**Использует:**
- Качественные критерии
- AI для оценки
- Memory для сравнения

---

### Agents.Publisher

**Ответственность:**
- Публикация на платформы
- Управление очередью
- Обработка ошибок

**Использует:**
- Platform clients
- Scheduler для тайминга
- Retry logic

---

### Agents.Archivist

**Ответственность:**
- Сохранение всех решений
- Индексация контента
- Поиск похожих тем

**Использует:**
- Memory storage
- Embeddings
- Search index

---

### Memory.Storage

**Технологии:**
- SQLite для структурированных данных
- JSON для гибких структур
- Векторная БД для embeddings

**Хранит:**
- Темы и контент
- Решения и причины
- Метрики
- Эволюцию стилей

---

### AI.Router

**Логика выбора модели:**
- Gemini 2.0 Flash - по умолчанию (быстрое мышление)
- Gemini 1.5 Pro - для длинного анализа, памяти, новостей

**Особенности:**
- Контроль лимитов
- Очередь при превышении
- Автоматический fallback

---

### Platforms.Base

Базовый интерфейс для всех платформ.

**Методы:**
- `authenticate()` - авторизация
- `validate_credentials()` - проверка
- `publish()` - публикация
- `get_status()` - статус

---

## Поток данных

### Типичный цикл публикации:

1. **Scheduler** запускает цикл
2. **Thinker** выбирает тему (или решает не публиковать)
3. **Writer** создает контент
4. **Editor** адаптирует под платформу
5. **Critic** оценивает качество
6. Если одобрено → **Publisher** публикует
7. **Archivist** сохраняет все данные
8. **Reflection** обновляет стратегию

---

## Конфигурация

### Уровни конфигурации:

1. **System** - базовые настройки (AI ключи, пути)
2. **Goals** - высокоуровневые цели
3. **Platforms** - настройки платформ
4. **Agents** - параметры агентов
5. **Memory** - настройки памяти

Все конфигурации хранятся локально, зашифрованы.

---

## Безопасность

- Все токены шифруются (AES-256)
- Локальное хранение
- Никакой телеметрии
- Проверка прав на платформах

---

## Расширяемость

Система спроектирована для расширения:

- Новые агенты добавляются через наследование Base
- Новые платформы через Base platform
- Новые модели через Router
- Новые типы памяти через Storage

---

## Тестирование

Каждый модуль должен быть:
- Изолированно тестируем
- Имеет mock-интерфейсы
- Логирует свои действия

---

## Дальнейшее развитие

- Поддержка новых платформ
- Улучшение агентов
- Расширенная аналитика
- Визуализация решений

